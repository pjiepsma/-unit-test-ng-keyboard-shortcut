plugins {
  id "com.github.node-gradle.node" version "3.2.1"
}

node {
  version = '16.15.0'
  npmVersion = '8.5.5'
  download = true
  npmInstallCommand = 'ci'
}

task buildAngularApp(type: NpmTask) {
  dependsOn npmInstall
  args = ['run','build']
  inputs.files fileTree("src")
  inputs.file 'package.json'
  inputs.file 'package-lock.json'
  outputs.dir('dist')
}

task testCi (type: NpmTask) {
  dependsOn buildAngularApp
  args = ['run','test']
}

clean.doFirst {
  delete "${projectDir}/dist"
  println "${projectDir}/dist removed"
}

jar {
  from 'dist/static/planning' into 'static/planning'
}

jar.dependsOn 'buildAngularApp'

